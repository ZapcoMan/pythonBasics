#!/usr/bin/env python3
"""
UI ç®¡ç†å™¨ - CVE-2025-55184 åˆ©ç”¨å·¥å…·çš„ç°ä»£ç»ˆç«¯ç•Œé¢
ä½œè€…: CyberTechAjju
"""

from rich.console import Console
from rich.panel import Panel
from rich.table import Table
from rich.progress import Progress, SpinnerColumn, BarColumn, TextColumn, TimeRemainingColumn
from rich.layout import Layout
from rich.live import Live
from rich.text import Text
from rich.syntax import Syntax
from rich import box
from rich.align import Align
import pyfiglet
from datetime import datetime
import time


class UIManager:
    def __init__(self):
        self.console = Console()
        self.theme = {
            'primary': 'cyan',
            'secondary': 'magenta',
            'success': 'green',
            'error': 'red',
            'warning': 'yellow',
            'info': 'blue'
        }
        
    def clear_screen(self):
        """æ¸…é™¤ç»ˆç«¯å±å¹•"""
        self.console.clear()
        
    def show_banner(self):
        """æ˜¾ç¤ºåŠ¨ç”»ASCIIè‰ºæœ¯æ¨ªå¹…"""
        self.clear_screen()
        
        # åˆ›å»ºASCIIè‰ºæœ¯æ¨ªå¹…
        banner_text = pyfiglet.figlet_format("CVE-2025-55184", font="slant")
        subtitle = pyfiglet.figlet_format("EXPLOIT TOOL", font="term")
        
        # åˆ›å»ºæ¸å˜æ•ˆæœ
        banner_lines = banner_text.split('\n')
        
        # ç”¨æ¸å˜è‰²å½©æ˜¾ç¤º
        gradient_banner = Text()
        colors = ['bright_cyan', 'cyan', 'blue', 'bright_blue', 'magenta', 'bright_magenta']
        
        for i, line in enumerate(banner_lines):
            color = colors[i % len(colors)]
            gradient_banner.append(line + '\n', style=color)
        
        # æ·»åŠ å‰¯æ ‡é¢˜
        gradient_banner.append(subtitle, style='bright_magenta bold')
        
        # åˆ›å»ºé¢æ¿
        banner_panel = Panel(
            Align.center(gradient_banner),
            border_style='bright_cyan',
            box=box.DOUBLE,
            subtitle='[bright_white]ç”± [bold bright_cyan]CyberTechAjju[/bold bright_cyan] åˆ¶ä½œ | [bold yellow]"æŒç»­å­¦ä¹ ï¼ŒæŒç»­é»‘å®¢æŠ€æœ¯"[/bold yellow][/bright_white]'
        )
        
        self.console.print(banner_panel)
        self.console.print()
        
    def show_warning(self):
        """æ˜¾ç¤ºé“å¾·ä½¿ç”¨è­¦å‘Š"""
        warning_text = """
âš ï¸  ä»…é™é“å¾·ä½¿ç”¨ - éœ€è¦æˆæƒæµ‹è¯• âš ï¸

æœ¬å·¥å…·è®¾è®¡ç”¨äºï¼š
  â€¢ ç»æˆæƒçš„æ¸—é€æµ‹è¯•
  â€¢ æ˜ç¡®åŒæ„ä¸‹çš„æ¼æ´èµé‡‘ç ”ç©¶
  â€¢ å—æ§ç¯å¢ƒä¸­çš„å®‰å…¨ç ”ç©¶

æœªç»æˆæƒçš„ä½¿ç”¨æ˜¯éæ³•ä¸”ä¸é“å¾·çš„ï¼
ä½œè€…å¯¹æ»¥ç”¨è¡Œä¸ºä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚
        """
        
        warning_panel = Panel(
            warning_text,
            title="[bold red]âš¡ æ³•å¾‹å…è´£å£°æ˜ âš¡[/bold red]",
            border_style='red',
            box=box.HEAVY
        )
        
        self.console.print(warning_panel)
        self.console.print()
        
    def get_authorization(self, target):
        """æç¤ºç”¨æˆ·ç¡®è®¤æˆæƒ"""
        self.console.print(f"\n[yellow]ç›®æ ‡:[/yellow] [bold white]{target}[/bold white]")
        self.console.print("\n[bold red]âš ï¸  æ‚¨æ˜¯å¦æœ‰æ˜ç¡®æˆæƒæµ‹è¯•æ­¤ç›®æ ‡ï¼Ÿ[/bold red]")
        
        response = self.console.input("[yellow]è¾“å…¥ 'YES I AM AUTHORIZED' ç»§ç»­:[/yellow] ")
        
        return response.strip() == "YES I AM AUTHORIZED"
        
    def show_menu(self):
        """æ˜¾ç¤ºäº¤äº’å¼ä¸»èœå•"""
        menu_table = Table(
            show_header=True,
            header_style="bold bright_cyan",
            border_style="cyan",
            box=box.ROUNDED
        )
        
        menu_table.add_column("é€‰é¡¹", style="bright_cyan", justify="center", width=10)
        menu_table.add_column("æ¨¡å¼", style="bright_white", width=20)
        menu_table.add_column("æè¿°", style="dim white", width=50)
        
        menu_table.add_row("1", "ğŸ” æ£€æµ‹", "è¢«åŠ¨æ£€æµ‹ï¼ˆå®‰å…¨ï¼Œéä¾µå…¥å¼ï¼‰")
        menu_table.add_row("2", "ğŸ¯ ä¸»åŠ¨æ‰«æ", "ä¸»åŠ¨æ¼æ´æ£€æŸ¥ï¼ˆæœ€å°å½±å“ï¼‰")
        menu_table.add_row("3", "ğŸ’¥ å•æ¬¡æ”»å‡»", "å•æ¬¡DoSå°è¯•ï¼ˆä½å¼ºåº¦ï¼‰")
        menu_table.add_row("4", "âš¡ å¤šçº¿ç¨‹", "å¤šçº¿ç¨‹æ”»å‡»ï¼ˆä¸­ç­‰å¼ºåº¦ï¼‰")
        menu_table.add_row("5", "ğŸ”¥ æ¿€è¿›æ¨¡å¼", "æ¿€è¿›çš„æŒç»­æ”»å‡»ï¼ˆé«˜å¼ºåº¦ï¼‰")
        menu_table.add_row("6", "ğŸ›¡ï¸  WAFç»•è¿‡", "è‡ªåŠ¨åŒ–WAFæ£€æµ‹å’Œç»•è¿‡")
        menu_table.add_row("7", "ğŸ“Š æŠ¥å‘Š", "ç”Ÿæˆæ¼æ´èµé‡‘æŠ¥å‘Š")
        menu_table.add_row("8", "âš™ï¸  é…ç½®", "æŸ¥çœ‹/ç¼–è¾‘é…ç½®")
        menu_table.add_row("0", "âŒ é€€å‡º", "é€€å‡ºå·¥å…·")
        
        panel = Panel(
            menu_table,
            title="[bold bright_magenta]âš¡ æ”»å‡»æ¨¡å¼ âš¡[/bold bright_magenta]",
            border_style="bright_magenta",
            box=box.DOUBLE
        )
        
        self.console.print(panel)
        
    def show_target_info(self, target_data):
        """æ˜¾ç¤ºç›®æ ‡ä¿¡æ¯è¡¨"""
        info_table = Table(
            show_header=False,
            border_style="cyan",
            box=box.SIMPLE
        )
        
        info_table.add_column("å±æ€§", style="bright_cyan bold", width=20)
        info_table.add_column("å€¼", style="bright_white", width=60)
        
        for key, value in target_data.items():
            info_table.add_row(key, str(value))
        
        panel = Panel(
            info_table,
            title="[bold cyan]ğŸ¯ ç›®æ ‡ä¿¡æ¯[/bold cyan]",
            border_style="cyan"
        )
        
        self.console.print(panel)
        
    def create_progress_bar(self, description):
        """åˆ›å»ºç°ä»£åŒ–è¿›åº¦æ¡"""
        return Progress(
            SpinnerColumn(spinner_name="dots"),
            TextColumn("[progress.description]{task.description}"),
            BarColumn(complete_style="green", finished_style="bright_green"),
            TextColumn("[progress.percentage]{task.percentage:>3.0f}%"),
            TimeRemainingColumn(),
            console=self.console
        )
        
    def show_attack_dashboard(self, stats):
        """æ˜¾ç¤ºå®æ—¶æ”»å‡»ç»Ÿè®¡æ•°æ®ä»ªè¡¨æ¿"""
        layout = Layout()
        
        layout.split_column(
            Layout(name="header", size=3),
            Layout(name="stats", size=10),
            Layout(name="footer", size=3)
        )
        
        # æ ‡é¢˜
        header = Text("âš¡ å®æ—¶æ”»å‡»ä»ªè¡¨æ¿ âš¡", style="bold bright_magenta", justify="center")
        layout["header"].update(Panel(header, border_style="bright_magenta"))
        
        # ç»Ÿè®¡è¡¨
        stats_table = Table(
            show_header=True,
            header_style="bold bright_cyan",
            border_style="cyan",
            box=box.ROUNDED
        )
        
        stats_table.add_column("æŒ‡æ ‡", style="bright_cyan", width=25)
        stats_table.add_column("æ•°å€¼", style="bright_white", justify="right", width=20)
        stats_table.add_column("çŠ¶æ€", style="bright_green", justify="center", width=15)
        
        stats_table.add_row(
            "æ€»è¯·æ±‚æ•°", 
            str(stats.get('total_requests', 0)),
            "âœ“" if stats.get('total_requests', 0) > 0 else "â—‹"
        )
        stats_table.add_row(
            "æˆåŠŸæ”»å‡»", 
            str(stats.get('successful', 0)),
            "ğŸ’¥" if stats.get('successful', 0) > 0 else "â—‹"
        )
        stats_table.add_row(
            "è¶…æ—¶æ¬¡æ•°", 
            str(stats.get('timeouts', 0)),
            "â±ï¸" if stats.get('timeouts', 0) > 0 else "â—‹"
        )
        stats_table.add_row(
            "é”™è¯¯æ•°é‡", 
            str(stats.get('errors', 0)),
            "âŒ" if stats.get('errors', 0) > 0 else "â—‹"
        )
        stats_table.add_row(
            "æˆåŠŸç‡", 
            f"{stats.get('success_rate', 0):.1f}%",
            "ğŸ¯"
        )
        
        layout["stats"].update(Panel(stats_table, border_style="cyan"))
        
        # åº•éƒ¨
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        footer = Text(f"â° {timestamp}", style="dim white", justify="center")
        layout["footer"].update(Panel(footer, border_style="dim white"))
        
        return layout
        
    def show_result(self, result_type, message, details=None):
        """æ˜¾ç¤ºæ“ä½œç»“æœåŠç›¸åº”æ ·å¼"""
        if result_type == 'success':
            icon = "âœ…"
            style = "bold green"
            border = "green"
        elif result_type == 'error':
            icon = "âŒ"
            style = "bold red"
            border = "red"
        elif result_type == 'warning':
            icon = "âš ï¸"
            style = "bold yellow"
            border = "yellow"
        else:
            icon = "â„¹ï¸"
            style = "bold cyan"
            border = "cyan"
        
        content = f"{icon} {message}"
        
        if details:
            content += f"\n\n{details}"
        
        panel = Panel(
            content,
            border_style=border,
            box=box.ROUNDED
        )
        
        self.console.print(panel)
        
    def show_vulnerability_status(self, is_vulnerable, confidence=None):
        """æ˜¾ç¤ºæ¼æ´çŠ¶æ€åŠå¯è§†åŒ–æŒ‡ç¤ºå™¨"""
        if is_vulnerable:
            status_text = Text()
            status_text.append("ğŸ”´ å­˜åœ¨æ¼æ´ ", style="bold red")
            status_text.append("- ç›®æ ‡æ˜“å—CVE-2025-55184æ”»å‡»", style="white")
            
            if confidence:
                status_text.append(f"\n\nğŸ¯ ç½®ä¿¡åº¦: {confidence}%", style="bold yellow")
            
            border_style = "red"
            box_style = box.HEAVY
        else:
            status_text = Text()
            status_text.append("ğŸŸ¢ æ— æ¼æ´ ", style="bold green")
            status_text.append("- ç›®æ ‡ä¼¼ä¹å·²ä¿®è¡¥æˆ–ä¸å—å½±å“", style="white")
            
            border_style = "green"
            box_style = box.ROUNDED
        
        panel = Panel(
            status_text,
            title="[bold white]æ¼æ´è¯„ä¼°[/bold white]",
            border_style=border_style,
            box=box_style
        )
        
        self.console.print(panel)
        
    def show_payload_info(self, payload_name, payload_data):
        """æ˜¾ç¤ºè½½è·ä¿¡æ¯"""
        table = Table(
            show_header=False,
            border_style="magenta",
            box=box.ROUNDED
        )
        
        table.add_column("å±æ€§", style="bright_magenta bold", width=20)
        table.add_column("å€¼", style="bright_white", width=60)
        
        table.add_row("åç§°", payload_data.get('name', 'æœªçŸ¥'))
        table.add_row("ç¼–ç ", payload_data.get('encoding', 'æ— '))
        table.add_row("æˆåŠŸç‡", f"{payload_data.get('success_rate', 0)}%")
        table.add_row("æ¡†æ¶", ', '.join(payload_data.get('frameworks', [])))
        table.add_row("æè¿°", payload_data.get('description', 'N/A'))
        
        # æ˜¾ç¤ºå®é™…è½½è·å†…å®¹å¹¶è¯­æ³•é«˜äº®
        payload_text = payload_data.get('payload', '')
        syntax = Syntax(payload_text, "python", theme="monokai", line_numbers=False)
        
        self.console.print(Panel(
            table,
            title=f"[bold bright_magenta]ğŸ’£ è½½è·: {payload_name}[/bold bright_magenta]",
            border_style="bright_magenta"
        ))
        
        self.console.print(Panel(
            syntax,
            title="[bold white]è½½è·å†…å®¹[/bold white]",
            border_style="white"
        ))
        
    def show_waf_detection(self, waf_info):
        """æ˜¾ç¤ºWAFæ£€æµ‹ç»“æœ"""
        if waf_info['detected']:
            waf_table = Table(
                show_header=False,
                border_style="yellow",
                box=box.HEAVY
            )
            
            waf_table.add_column("å±æ€§", style="bright_yellow bold", width=20)
            waf_table.add_column("å€¼", style="bright_white", width=60)
            
            waf_table.add_row("æ£€æµ‹åˆ°WAF", "ğŸ›¡ï¸  æ˜¯")
            waf_table.add_row("ç±»å‹", waf_info.get('type', 'æœªçŸ¥'))
            waf_table.add_row("ç½®ä¿¡åº¦", f"{waf_info.get('confidence', 0)}%")
            waf_table.add_row("å¯ç»•è¿‡", "âœ“ æ˜¯" if waf_info.get('bypass_available') else "âœ— å¦")
            
            panel = Panel(
                waf_table,
                title="[bold yellow]ğŸ›¡ï¸  WAF æ£€æµ‹ç»“æœ[/bold yellow]",
                border_style="yellow",
                box=box.HEAVY
            )
        else:
            panel = Panel(
                "ğŸŸ¢ æœªæ£€æµ‹åˆ°WAF - å¯ç›´æ¥åˆ©ç”¨",
                title="[bold green]WAF æ£€æµ‹[/bold green]",
                border_style="green"
            )
        
        self.console.print(panel)
        
    def show_spinner(self, message):
        """ä¸ºé•¿æ—¶é—´æ“ä½œæ˜¾ç¤ºæ—‹è½¬å…‰æ ‡"""
        return self.console.status(f"[cyan]{message}...", spinner="dots")
        
    def prompt_input(self, prompt_text, password=False):
        """è·å–ç”¨æˆ·è¾“å…¥å¹¶å¸¦æ ·å¼æç¤º"""
        if password:
            return self.console.input(f"[cyan]{prompt_text}:[/cyan] ", password=True)
        return self.console.input(f"[cyan]{prompt_text}:[/cyan] ")
        
    def print_success(self, message):
        """æ‰“å°æˆåŠŸæ¶ˆæ¯"""
        self.console.print(f"[green]âœ“[/green] {message}")
        
    def print_error(self, message):
        """æ‰“å°é”™è¯¯æ¶ˆæ¯"""
        self.console.print(f"[red]âœ—[/red] {message}")
        
    def print_warning(self, message):
        """æ‰“å°è­¦å‘Šæ¶ˆæ¯"""
        self.console.print(f"[yellow]âš [/yellow] {message}")
        
    def print_info(self, message):
        """æ‰“å°ä¿¡æ¯æ¶ˆæ¯"""
        self.console.print(f"[cyan]â„¹[/cyan] {message}")